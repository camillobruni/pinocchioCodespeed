{% extends "base.html" %}
{% block script %}
<script type="text/javascript" src="/media/js/jquery.tablesorter.min.js"></script>
<script type="text/javascript">
  var config = {"petardo": 2};
  
  function updateTable() {
    var tdwidth = parseInt($("#results thead tr").find("th:eq(5)").css("width"));
    $("#results > tbody > tr").each(function() {
      //Color change column
      var change = $(this).children("td:eq(2)").text().slice(0, -1);
      var colorcode = "status-yellow";
      if(change > 0.3) { colorcode = "status-red"; }
      else if(change < -0.3) { colorcode = "status-green"; }
      $(this).children("td:eq(2)").addClass(colorcode);
      //Color comparison column
      var comp = $(this).children("td:eq(4)").text().slice(0, -1);
//       $(this).children("td:eq(4)").text(comp + "x");
      colorcode = "status-yellow";
      if(comp < 0.8) { colorcode = "status-red"; }
      else if(comp > 1.2) { colorcode = "status-green"; }
      $(this).children("td:eq(4)").addClass(colorcode);
      //Size bars according to comparison value
      comp = comp*58;
      if (comp > tdwidth) {
          comp = "100%";
      } else { comp = comp + "px"; }
/*      $(this).children("td:eq(5)").find("img").width(comp);*/
      $(this).children("td:eq(5)").find("span").css("width", comp);
    });
    //sort by default by the 5th column
    $.tablesorter.defaults.sortList = [[4,0]];
    //disable sorting for graphs
    $.tablesorter.defaults.headers = { 5: { sorter: false } };
    $("#results").tablesorter({widgets: ['zebra']});
    $("#results tbody td").hover(function() {
    $(this).parents('tr').addClass('highlight');
    }, function() {
      $(this).parents('tr').removeClass('highlight');
    });
  }
  
  function readConfiguration() {
    config["trend"] = $("#trend option:selected").val();
  }
  
  function refreshContent() {
    readConfiguration();
    $.ajaxSetup ({  
         cache: false  
    });
    
    //loading text
    w = "width:" + $("#content").css("width");
    h2 = parseInt($("#content").css("height")) - 16;
    if(h2 < 40) { h2 = 40; }
    h = "height:" + h2;
//     alert(h);
    h2 = h2/2 + 30;
//     alert(h + " parsed: " + parseInt(h));
    var ajax_load = '<div style="text-align:center;' + w + ';' + h + 'px;"><p style="line-height:' + h2 + 'px;">loading...</p></div>';
    
    var loadUrl = "table/";
    $("#content").html(ajax_load).load(loadUrl, $.param(config), function(responseText) { updateTable(); });
//     alert($("#content").css("height"));
  }
  
  function onSelectChange() {
    var selected = $("#trend option:selected");     
    var output = "";
    if(selected.val() != 0){
      output = "You Selected " + selected.text();
    }
    refreshContent();
  }

  $(function() {
    $("#trend").val({{ trendconfig }});
    $("#trend").change(onSelectChange);
    refreshContent();
  });
</script>
{% endblock %}

{% block navigation %}
  <div id="tabs">
    <ul>
      <li><a href="#" class="current">Overview</a></li>
      <li><a href="#">Timeline</a></li>
      <li><a href="/results/">Results</a></li>
    </ul>
  </div>
{% endblock %}

{% block body %}
<div id="sidebar">
<div id="interpreter" class="sidebox">
  <div class="boxhead"><h2>Interpreter</h2></div>
  <div class="boxbody">
    <ul>
    {% for inter in interpreters %}
        <li id="interpreter{{inter.id}}">{{ inter }}</li>{% endfor %}
    </ul>
  </div>
</div>
<div class="sidebox">
  <div class="boxhead"><h2>Host</h2></div>
  <div class="boxbody">
  <ul>
    {% for host in hostlist %}  <li>{{ host }}</li>{% endfor %}
  </ul>
  </div>
</div>
<div id="options" class="sidebox">
  <div class="boxhead"><h2>Options</h2></div>
  <div class="boxbody">
  <ul>
    <li title="Trend since {{ trendconfig }} tested revisions ago">Trend: <select id="trend"><option value="5">5</option><option value="10">10</option><option value="20">20</option></select>
    </li>
<!--     <li id="output">{{ trendconfig }}</li> -->
  </ul>
  </div>
</div>
</div>

<div id="configbar">Results for revision {{ lastrevision }}</div>
<div id="content">
<table class="tablesorter"></table>
</div>
{% endblock %}
