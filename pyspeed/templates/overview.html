{% extends "base.html" %}
{% block script %}
<script type="text/javascript" src="/media/js/jquery.tablesorter.min.js"></script>
<script type="text/javascript">
  function getConfiguration() {
    var config = new Object();
    config["trend"] = $("#trend option:selected").val();
    config["revision"] = $("#revision option:selected").val();
    config["interpreter"] = $("input[name='interpreter']:checked").val();
    return config;
  }
  
  function permalink() {
    window.location="?" + $.param(getConfiguration());
  }
  
  function permalinkToTimeline(benchmark) {
    var conf = new Object();
    conf["interpreters"] = $("input[name='interpreter']:checked").val();
    conf["benchmark"] = benchmark;
    window.location="/timeline/?" + ued_encode(conf);
  }
  
  function updateTable() {
    $("#results > tbody > tr").each(function() {
      //Color change column
      var change = $(this).children("td:eq(2)").text().slice(0, -1);
      var colorcode = "status-yellow";
      if(change > 0.3) { colorcode = "status-red"; }
      else if(change < -0.3) { colorcode = "status-green"; }
      $(this).children("td:eq(2)").addClass(colorcode);
      //Color comparison column
      var comp = parseFloat($(this).children("td:eq(4)").text())
      colorcode = "status-yellow";
      if(comp < 0.8) { colorcode = "status-red"; }
      else if(comp > 1.2) { colorcode = "status-green"; }
      $(this).children("td:eq(4)").addClass(colorcode);
      //Size plot bars
      var tdwidth = parseInt($("#results thead tr").find("th:eq(5)").css("width"));
      var bar = transToLogBars(58, tdwidth, comp);
      $(this).children("td:eq(5)").find("span").css("width", bar["width"]).css("margin-left", bar["margin"]);
      //Link rows to timelines
      $(this).click(function () { 
        permalinkToTimeline($(this).children("td:eq(0)").text());
      });
    });
    //Configure table as tablesorter
    $.tablesorter.defaults.sortList = [[4,0]];//sort by default by the 5th column
    $.tablesorter.defaults.headers = { 5: { sorter: false } };//disable sorting for bar column
    $("#results").tablesorter({widgets: ['zebra']});
    $("#results tbody td").hover(function() {
      $(this).parents('tr').addClass('highlight');
    }, function() {
      $(this).parents('tr').removeClass('highlight');
    });
  }
  
  function refreshContent() {
    $.ajaxSetup ({
      cache: false
    });
    
    h = parseInt($("#content").css("height"));//get height for loading text
    $("#results").fadeOut("fast", function() {
      $("#content").html(getLoadText("Loading...", h));
    });
    $("#content").load("table/", $.param(getConfiguration()), function(responseText) { updateTable(); });
  }
  
  $(function() {
    // Configure defaults
    $("#trend").val({{ defaulttrend }});
    $("#trend").change(refreshContent);
    $("#revision").val({{ selectedrevision }});
    $("#revision").change(refreshContent);
    $("input:radio[name=interpreter]").filter('[value={{ defaultinterpreter }}]').attr('checked', true);
    $("input[name='interpreter']").change(refreshContent);

    refreshContent();
  });
</script>
{% endblock %}

{% block navigation %}
<!--   <div id="tabs"> -->
    <ul>
      <li><a href="/overview/" class="current">Overview</a></li>
      <li><a href="/timeline/">Timeline</a></li>
<!--       <li><a href="/comparison/">Comparison</a></li> -->
    </ul>
<!--   </div> -->
{% endblock %}

{% block body %}
<div id="sidebar">
<div id="interpreter" class="sidebox">
  <div class="boxhead"><h2>Interpreter</h2></div>
  <div class="boxbody">
    {% for inter in interpreters %}
    <input id="interpreter{{ inter.id }}" type="radio" name="interpreter" value="{{ inter.id }}" />
    <label for="interpreter{{ inter.id }}">{{ inter }}</label>
    <br>
    {% endfor %}
  </div>
</div>
<div class="sidebox">
  <div class="boxhead"><h2>Host</h2></div>
  <div class="boxbody">
  <ul>
    {% for host in hostlist %}  <li>{{ host }}</li>{% endfor %}
  </ul>
  </div>
</div>
<div id="options" class="sidebox">
  <div class="boxhead"><h2>Options</h2></div>
  <div class="boxbody">
  <ul>
    <li title="Trend since {{ defaulttrend }} tested revisions ago. Average of 3 revisions">Trend:
      <select id="trend">
      {% for trend in trends %}<option value="{{ trend }}">{{ trend }}</option><br>{% endfor %}
      </select>
    </li>
  </ul>
  </div>
</div>
</div>

<div id="configbar">Results for revision
  <select id="revision">{% for rev in lastrevisions %}
    <option value="{{ rev }}">{{ rev }}</option>{% endfor %}
  </select><a id="permalink" href="javascript:permalink();">Permalink</a>
</div>
<div id="content">
<table id="results" class="tablesorter" style="height: 232px;"></table>
</div>
{% endblock %}
